# SCHEMA FIELD USAGE ANALYSIS — COMPLETE AUDIT

**Date:** Current  
**Purpose:** Verify which schema fields are actually used in the app codebase  
**Scope:** All tables, all fields, all operations (SELECT, INSERT, UPDATE)

---

## EXECUTIVE SUMMARY

### Overall Usage:
- **Total Schema Fields:** ~80+ fields across 9 tables
- **Fields Used in App:** ~35 fields (44%)
- **Fields NOT Used:** ~45 fields (56%)
- **Critical Missing:** Many customer KYC fields, withdrawal fields, metadata fields

---

## DETAILED BREAKDOWN BY TABLE

### 1. PROFILES TABLE

**Schema Fields (11):**
- `id` ✅ USED
- `user_id` ✅ USED
- `role` ✅ USED
- `phone` ✅ USED
- `name` ✅ USED
- `email` ✅ USED (partially)
- `active` ✅ USED
- `created_at` ✅ USED (partially)
- `updated_at` ❌ NOT USED
- `device_id` ❌ NOT USED
- `client_timestamp` ❌ NOT USED

**Usage Details:**
```dart
// SELECT queries found:
- 'id, name, phone' (staff_data_service.dart:95)
- 'id, role' (main.dart:199, role_routing_service.dart:215)
- 'role, active' (role_routing_service.dart:22)
- 'id, role, active' (role_routing_service.dart:103)
- 'id, name, phone, email, role, active, created_at' (staff_data_service.dart:556)
- 'id' (multiple places for lookups)
```

**Status:** ✅ **7/11 fields used (64%)**

---

### 2. CUSTOMERS TABLE

**Schema Fields (15):**
- `id` ✅ USED
- `profile_id` ✅ USED
- `address` ✅ USED
- `city` ❌ NOT USED
- `state` ❌ NOT USED
- `pincode` ❌ NOT USED
- `date_of_birth` ❌ NOT USED
- `pan_number` ❌ NOT USED
- `aadhaar_number` ❌ NOT USED
- `nominee_name` ❌ NOT USED
- `nominee_relation` ❌ NOT USED
- `nominee_phone` ❌ NOT USED
- `created_at` ❌ NOT USED
- `updated_at` ❌ NOT USED
- `device_id` ❌ NOT USED
- `client_timestamp` ❌ NOT USED

**Usage Details:**
```dart
// SELECT queries found:
- 'id, profile_id, address' (staff_data_service.dart:62)
- 'id' (payment_service.dart:74, 103)
```

**Status:** ❌ **3/15 fields used (20%)** — Most KYC fields unused

---

### 3. USER_SCHEMES TABLE

**Schema Fields (18):**
- `id` ✅ USED
- `customer_id` ✅ USED
- `scheme_id` ✅ USED
- `enrollment_date` ✅ USED (in order by)
- `status` ✅ USED
- `payment_frequency` ✅ USED
- `min_amount` ✅ USED
- `max_amount` ✅ USED
- `total_amount_paid` ✅ USED
- `payments_made` ✅ USED
- `payments_missed` ✅ USED
- `accumulated_grams` ✅ USED
- `maturity_date` ❌ NOT USED
- `completed_date` ❌ NOT USED
- `created_at` ❌ NOT USED
- `updated_at` ❌ NOT USED
- `device_id` ❌ NOT USED
- `client_timestamp` ❌ NOT USED

**Usage Details:**
```dart
// SELECT queries found:
- 'id, scheme_id, status, payment_frequency, min_amount, max_amount, total_amount_paid, payments_made, payments_missed, accumulated_grams' (staff_data_service.dart:109)
- 'id' (payment_service.dart:37, 51)
- '*, schemes(*)' (dashboard_screen.dart:1385, withdrawal_list_screen.dart:45)
- 'schemes!inner(name)' (staff_data_service.dart:319)
```

**Status:** ✅ **12/18 fields used (67%)**

---

### 4. SCHEMES TABLE

**Schema Fields (17):**
- `id` ✅ USED
- `scheme_code` ❌ NOT USED
- `name` ✅ USED
- `asset_type` ✅ USED
- `min_daily_amount` ❌ NOT USED
- `max_daily_amount` ❌ NOT USED
- `installment_amount` ❌ NOT USED
- `frequency` ❌ NOT USED
- `duration_months` ❌ NOT USED
- `entry_fee` ❌ NOT USED
- `expected_grams` ❌ NOT USED
- `metal_accumulation_text` ❌ NOT USED
- `description` ❌ NOT USED
- `features` ❌ NOT USED
- `how_it_works` ❌ NOT USED
- `active` ❌ NOT USED
- `created_at` ❌ NOT USED
- `updated_at` ❌ NOT USED

**Usage Details:**
```dart
// SELECT queries found:
- 'name, asset_type' (staff_data_service.dart:126)
- '*' (via join in dashboard_screen.dart:1385)
```

**Status:** ❌ **2/17 fields used (12%)** — Only name and asset_type

---

### 5. PAYMENTS TABLE

**Schema Fields (20):**
- `id` ❌ NOT USED (auto-generated)
- `user_scheme_id` ✅ USED (INSERT)
- `customer_id` ✅ USED (INSERT, SELECT)
- `staff_id` ✅ USED (INSERT, SELECT)
- `amount` ✅ USED (INSERT, SELECT)
- `gst_amount` ✅ USED (INSERT)
- `net_amount` ✅ USED (INSERT)
- `payment_method` ✅ USED (INSERT, SELECT)
- `payment_date` ✅ USED (INSERT, SELECT)
- `payment_time` ✅ USED (INSERT)
- `status` ✅ USED (INSERT, SELECT)
- `metal_rate_per_gram` ✅ USED (INSERT)
- `metal_grams_added` ✅ USED (INSERT)
- `is_reversal` ✅ USED (INSERT)
- `reverses_payment_id` ❌ NOT USED
- `reversal_reason` ❌ NOT USED
- `receipt_number` ❌ NOT USED (auto-generated by trigger)
- `notes` ❌ NOT USED
- `created_at` ❌ NOT USED
- `device_id` ✅ USED (INSERT)
- `client_timestamp` ✅ USED (INSERT)
- `server_timestamp` ❌ NOT USED (auto-generated)

**Usage Details:**
```dart
// INSERT found:
- All payment fields (payment_service.dart:178-193)

// SELECT queries found:
- 'amount, payment_method' (staff_data_service.dart:140, 201)
- 'amount, payment_method, customer_id' (staff_data_service.dart:201)
- 'payment_date, amount, status, payment_method' (staff_data_service.dart:351)
- Complex joins with customers/profiles (staff_data_service.dart:296, 402)
```

**Status:** ✅ **14/20 fields used (70%)**

---

### 6. MARKET_RATES TABLE

**Schema Fields (8):**
- `id` ❌ NOT USED
- `rate_date` ✅ USED (in order by)
- `asset_type` ✅ USED
- `price_per_gram` ✅ USED
- `change_amount` ❌ NOT USED
- `change_percent` ❌ NOT USED
- `created_by` ❌ NOT USED
- `created_at` ❌ NOT USED

**Usage Details:**
```dart
// SELECT queries found:
- 'price_per_gram' (payment_service.dart:15)
- Ordered by 'rate_date' (payment_service.dart:17)
```

**Status:** ⚠️ **3/8 fields used (38%)** — Minimal usage

---

### 7. STAFF_METADATA TABLE

**Schema Fields (12):**
- `id` ❌ NOT USED
- `profile_id` ✅ USED
- `staff_code` ✅ USED
- `staff_type` ✅ USED
- `daily_target_amount` ✅ USED
- `daily_target_customers` ✅ USED
- `is_active` ❌ NOT USED
- `join_date` ✅ USED
- `created_at` ❌ NOT USED
- `updated_at` ❌ NOT USED
- `device_id` ❌ NOT USED
- `client_timestamp` ❌ NOT USED

**Usage Details:**
```dart
// SELECT queries found:
- 'staff_type' (role_routing_service.dart:62)
- 'daily_target_amount, daily_target_customers' (staff_data_service.dart:484)
- 'staff_code, staff_type, daily_target_amount, daily_target_customers, join_date' (staff_data_service.dart:566)
- '*' (staff_data_service.dart:597)
```

**Status:** ✅ **6/12 fields used (50%)**

---

### 8. STAFF_ASSIGNMENTS TABLE

**Schema Fields (9):**
- `id` ❌ NOT USED
- `staff_id` ✅ USED
- `customer_id` ✅ USED
- `is_active` ✅ USED
- `assigned_date` ❌ NOT USED
- `unassigned_date` ❌ NOT USED
- `created_at` ❌ NOT USED
- `updated_at` ❌ NOT USED

**Usage Details:**
```dart
// SELECT queries found:
- 'customer_id' (staff_data_service.dart:36)
- 'staff_id, customer_id, is_active' (payment_service.dart:161, staff_data_service.dart:225)
```

**Status:** ✅ **3/9 fields used (33%)**

---

### 9. WITHDRAWALS TABLE

**Schema Fields (18):**
- `id` ❌ NOT USED
- `user_scheme_id` ❌ NOT USED
- `customer_id` ❌ NOT USED
- `withdrawal_type` ❌ NOT USED
- `requested_amount` ❌ NOT USED
- `requested_grams` ❌ NOT USED
- `status` ❌ NOT USED
- `approved_by` ❌ NOT USED
- `approved_at` ❌ NOT USED
- `processed_at` ❌ NOT USED
- `rejection_reason` ❌ NOT USED
- `final_amount` ❌ NOT USED
- `final_grams` ❌ NOT USED
- `request_notes` ❌ NOT USED
- `created_at` ❌ NOT USED
- `updated_at` ❌ NOT USED
- `device_id` ❌ NOT USED
- `client_timestamp` ❌ NOT USED

**Usage Details:**
```dart
// NO queries found for withdrawals table
// Only reference: withdrawal_list_screen.dart queries user_schemes, not withdrawals
```

**Status:** ❌ **0/18 fields used (0%)** — Table completely unused

---

## SUMMARY BY TABLE

| Table | Total Fields | Fields Used | Usage % | Status |
|-------|-------------|-------------|---------|--------|
| **profiles** | 11 | 7 | 64% | ✅ Good |
| **customers** | 15 | 3 | 20% | ❌ Poor |
| **user_schemes** | 18 | 12 | 67% | ✅ Good |
| **schemes** | 17 | 2 | 12% | ❌ Poor |
| **payments** | 20 | 14 | 70% | ✅ Good |
| **market_rates** | 8 | 3 | 38% | ⚠️ Minimal |
| **staff_metadata** | 12 | 6 | 50% | ⚠️ Partial |
| **staff_assignments** | 9 | 3 | 33% | ⚠️ Minimal |
| **withdrawals** | 18 | 0 | 0% | ❌ Unused |

**Overall:** ~35/128 fields used (27%)

---

## CRITICAL FINDINGS

### ❌ COMPLETELY UNUSED TABLES:
1. **withdrawals** — 0% usage
   - Table exists but no queries
   - `withdrawal_list_screen.dart` queries `user_schemes` instead

### ❌ HEAVILY UNUSED TABLES:
1. **customers** — 20% usage
   - Missing: city, state, pincode, date_of_birth, PAN, Aadhaar, nominee fields
   - Only using: id, profile_id, address

2. **schemes** — 12% usage
   - Missing: scheme_code, min/max amounts, duration, fees, description, features
   - Only using: name, asset_type

### ⚠️ PARTIALLY USED TABLES:
1. **market_rates** — 38% usage
   - Missing: change_amount, change_percent, created_by
   - Only using: price_per_gram, asset_type, rate_date

2. **staff_metadata** — 50% usage
   - Missing: is_active, timestamps, device_id
   - Using: staff_code, staff_type, targets, join_date

3. **staff_assignments** — 33% usage
   - Missing: assigned_date, unassigned_date, timestamps
   - Only using: staff_id, customer_id, is_active

### ✅ WELL-USED TABLES:
1. **payments** — 70% usage
2. **user_schemes** — 67% usage
3. **profiles** — 64% usage

---

## UNUSED FIELDS BY CATEGORY

### Metadata/Timestamps (Never Used):
- `created_at` (except profiles.created_at in one query)
- `updated_at` (all tables)
- `device_id` (all tables)
- `client_timestamp` (all tables)
- `server_timestamp` (payments)

### KYC Fields (Never Used):
- `customers.city`
- `customers.state`
- `customers.pincode`
- `customers.date_of_birth`
- `customers.pan_number`
- `customers.aadhaar_number`
- `customers.nominee_name`
- `customers.nominee_relation`
- `customers.nominee_phone`

### Scheme Details (Never Used):
- `schemes.scheme_code`
- `schemes.min_daily_amount`
- `schemes.max_daily_amount`
- `schemes.installment_amount`
- `schemes.frequency`
- `schemes.duration_months`
- `schemes.entry_fee`
- `schemes.expected_grams`
- `schemes.metal_accumulation_text`
- `schemes.description`
- `schemes.features`
- `schemes.how_it_works`
- `schemes.active`

### Payment Metadata (Never Used):
- `payments.receipt_number` (auto-generated, not read)
- `payments.notes`
- `payments.reverses_payment_id`
- `payments.reversal_reason`

### Withdrawal Fields (All Unused):
- Entire `withdrawals` table (18 fields)

---

## RECOMMENDATIONS

### Priority 1: Remove Unused Fields (If Not Needed)
- Consider removing `withdrawals` table if not implementing withdrawals
- Consider removing unused KYC fields if not collecting that data
- Consider removing scheme detail fields if not displaying them

### Priority 2: Implement Missing Features
- **Withdrawals:** Implement withdrawal requests/queries
- **Customer KYC:** Add UI to collect/display KYC fields
- **Scheme Details:** Display scheme descriptions, features, duration
- **Payment Receipts:** Display receipt_number in UI

### Priority 3: Clean Up Schema
- Remove fields that will never be used
- Or document why they exist (future features, compliance, etc.)

---

## CONCLUSION

**Only 27% of schema fields are actually used in the app codebase.**

**Most Critical Gaps:**
1. **Withdrawals table** — 100% unused
2. **Customer KYC fields** — 80% unused
3. **Scheme details** — 88% unused

**This suggests:**
- Schema is over-engineered for current app features
- OR app is under-implemented for schema capabilities
- Need to align schema with actual app requirements

